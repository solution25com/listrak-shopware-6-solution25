(()=>{"use strict";class t{static isSupported(){return"undefined"!==document.cookie}static setItem(t,r,i){if(null==t)throw Error("You must specify a key to set a cookie");let n=new Date;n.setTime(n.getTime()+864e5*i);let o="";"https:"===location.protocol&&(o="secure"),document.cookie="".concat(t,"=").concat(r,";expires=").concat(n.toUTCString(),";path=/;sameSite=lax;").concat(o)}static getItem(t){if(!t)return!1;let r=t+"=",i=document.cookie.split(";");for(let t=0;t<i.length;t++){let n=i[t];for(;" "===n.charAt(0);)n=n.substring(1);if(0===n.indexOf(r))return n.substring(r.length,n.length)}return!1}static removeItem(t){document.cookie="".concat(t,"= ; expires = Thu, 01 Jan 1970 00:00:00 GMT;path=/")}static key(){return""}static clear(){}}class r{init(t){this.send(t)}send(t){(function(t){"undefined"==typeof _ltk?document.addEventListener?document.addEventListener("ltkAsyncListener",function(){_ltk_util.ready(t)}):((e=document.documentElement).ltkAsyncProperty=0,e.attachEvent("onpropertychange",function(r){"ltkAsyncProperty"==r.propertyName&&_ltk_util.ready(t)})):_ltk_util.ready(t)})(function(){_ltk.Order.SetCustomer(t.email,t.firstName,t.lastName),_ltk.Order.OrderNumber=t.orderNumber,_ltk.Order.ItemTotal=t.itemTotal,_ltk.Order.ShippingTotal=t.shippingTotal,_ltk.Order.TaxTotal=t.taxTotal,_ltk.Order.OrderTotal=t.orderTotal,t.lineItems&&t.lineItems.length&&t.lineItems.forEach(t=>{_ltk.Order.AddItem(t.sku,t.quantity,t.price)}),_ltk.Order.Submit()})}}class i{init(t){this.send(t)}send(t){(function(t){"undefined"==typeof _ltk?document.addEventListener?document.addEventListener("ltkAsyncListener",function(){_ltk_util.ready(t)}):((e=document.documentElement).ltkAsyncProperty=0,e.attachEvent("onpropertychange",function(r){"ltkAsyncProperty"==r.propertyName&&_ltk_util.ready(t)})):_ltk_util.ready(t)})(function(){_ltk.SCA.Update("email",t.email),t.lineItems&&t.lineItems.length&&t.lineItems.forEach(t=>{_ltk.SCA.AddItemWithLinks(t.sku,t.quantity,t.price,t.title,t.imageUrl,t.productUrl)}),_ltk.SCA.Total=t.totalPrice,_ltk.SCA.Submit()})}}let{PluginBaseClass:n}=window;class o extends n{init(){let n=this.options.merchantId;t.getItem(this.options.listrakTrackingCookie)&&n&&(function(t,r,i){if("undefined"==typeof _ltk){var n=t.createElement("script");n.id="ltkSDK",n.src="https://cdn.listrakbi.com/scripts/script.js?m="+r+"&v="+i,t.querySelector("head").appendChild(n)}}(document,n,"1"),this._orderData=new r,this._cartData=new i,this.options.data&&(this.options.data.orderCompleted?this._orderData.init(this.options.data):this.getCart()))}getCart(){fetch("/checkout/cart.json").then(t=>t.json()).then(t=>{t.lineItems.length?this.handleCartItems(t):this.clearCart()}).catch(t=>{console.error("Error fetching cart:",t)})}handleCartItems(t){let r=this.options.data;r.totalPrice=t.price.totalPrice,r.lineItems=this.mapLineItems(t.lineItems),this._cartData.init(r)}mapLineItems(t){let r=[];return t.filter(t=>"promotion"!==t.type).forEach(t=>{let i=t.price.listPrice&&t.price.listPrice.price>t.price.unitPrice?t.price.listPrice.price:t.price.unitPrice,n={sku:t.payload.productNumber||"",quantity:t.quantity,price:i,title:t.label,totalPrice:t.price.totalPrice,imageUrl:t.cover?t.cover.url:"",productUrl:this.getProductUrl(t)};r.push(n)}),r}getProductUrl(t){return location.protocol+"//"+location.host+"/detail/"+t.id}clearCart(){(function(t){"undefined"==typeof _ltk?document.addEventListener?document.addEventListener("ltkAsyncListener",function(){_ltk_util.ready(t)}):((e=document.documentElement).ltkAsyncProperty=0,e.attachEvent("onpropertychange",function(r){"ltkAsyncProperty"==r.propertyName&&_ltk_util.ready(t)})):_ltk_util.ready(t)})(function(){_ltk.SCA.ClearCart()})}}o.options={listrakTrackingCookie:"listrakCartAbandonmentTracking"},window.PluginManager.register("AbandonedCartTracking",o,"[data-abandoned-cart-tracking]")})();